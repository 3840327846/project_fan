<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <!-- å·¦ä¾§å­˜æ¡£åŠŸèƒ½åŒº -->
            <div class="nav-left">
                <div class="save-load-buttons" style="display: none;">
                    <button class="nav-save-btn" id="navSaveBtn" title="ä¿å­˜æ¸¸æˆ" style="display: none;">
                        ğŸ’¾ ä¿å­˜
                    </button>
                    <button class="nav-load-btn" id="navLoadBtn" title="è¯»å–å­˜æ¡£" style="display: none;">
                        ğŸ“ è¯»å–
                    </button>
                </div>
            </div>
            
            <!-- å³ä¾§é‡‘å¸æ˜¾ç¤ºåŒºï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼‰ -->
            <div class="nav-right">
                <!-- é‡‘å¸æ˜¾ç¤ºç­‰å…¶ä»–å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </nav>

    <!-- æ¸¸æˆä¸»ä½“åŒºåŸŸ -->
    <main class="game-container">
        <!-- å…³å¡é€‰æ‹©é¢æ¿ -->
        <div class="level-panel" id="levelPanel">
            <h3 class="panel-title">åˆ‡æ¢åœ°åŒº</h3>
            <div class="panel-content">
                <!-- å…³å¡é€‰æ‹©å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- å…³å¡åŒºåŸŸ -->
        <div class="game-area" id="gameArea">
            <canvas id="gameCanvas" width="1200" height="768"></canvas>
        </div>
        
        <!-- æ“ä½œåŒºåŸŸ -->
        <div class="control-panel" id="controlPanel">
            <div class="control-content">
                <!-- æ“ä½œå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </main>

    <!-- å¼€å‘è€…åŠŸèƒ½æŒ‰é’® -->
    <button class="developer-button" id="developerButton" title="å¼€å‘è€…åŠŸèƒ½">
        ğŸ› ï¸
    </button>
    
    <!-- å¼€å‘è€…åŠŸèƒ½é¢æ¿ -->
    <div class="developer-panel" id="developerPanel">
        <div class="developer-panel-title">å¼€å‘è€…åŠŸèƒ½</div>
        <div class="developer-function">
            <button class="developer-btn gold-btn" id="addGoldBtn">
                ğŸ’° +1000 é‡‘å¸
            </button>
        </div>
        <div class="developer-function">
            <button class="developer-btn egg-btn" id="getAllEggsBtn">
                ğŸ¥š è·å¾—æ¯ç§è›‹1ä¸ª
            </button>
        </div>
        <div class="developer-function">
            <button class="developer-btn level-btn" id="levelUpAllBtn">
                â¬†ï¸ æ‰€æœ‰è§’è‰²ç­‰çº§+1
            </button>
        </div>
        <div class="developer-function">
            <button class="developer-btn skill-btn" id="getAllSkillBooksBtn">
                ğŸ“š è·å¾—æ¯ç§æŠ€èƒ½ä¹¦1æœ¬
            </button>
        </div>
        <div class="developer-function">
            <button class="developer-btn mana-btn" id="restoreAllManaBtn">
                ğŸ’™ æ‰€æœ‰è§’è‰²æ¢å¤100é­”æ³•å€¼
            </button>
        </div>
        <div class="developer-function">
            <button class="developer-btn materials-btn" id="addMaterialsBtn">
                ğŸ”¨ æ·»åŠ åˆ¶ä½œææ–™
            </button>
        </div>
        <div class="developer-function">
            <button class="developer-btn consumable-btn" id="addExpNotesBtn">
                ğŸ““ è·å¾—ç»éªŒç¬”è®°Ã—10
            </button>
        </div>
        <div class="developer-function">
            <button class="developer-btn food-btn" id="getAllFoodsBtn">
                ğŸ½ï¸ è·å¾—æ‰€æœ‰é£Ÿç‰©Ã—100
            </button>
        </div>
        <div class="developer-function">
            <button class="developer-btn kill-btn" id="addKillProgressBtn">
                âš”ï¸ å‡»æ€è¿›åº¦+15
            </button>
        </div>
        <div class="developer-function" style="display: none;">
            <button class="developer-btn save-btn" id="saveGameBtn">
                ğŸ’¾ ä¿å­˜æ¸¸æˆ
            </button>
        </div>
        <div class="developer-function" style="display: none;">
            <button class="developer-btn load-btn" id="loadGameBtn">
                ğŸ“ è¯»å–å­˜æ¡£
            </button>
        </div>
        <div class="developer-function" style="display: none;">
            <button class="developer-btn delete-btn" id="deleteSaveBtn">
                ğŸ—‘ï¸ åˆ é™¤å­˜æ¡£
            </button>
        </div>
    </div>

    <script>
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
            
            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯åœ¨é¢æ¿ä¸­
            const panelContent = document.querySelector('.panel-content');
            const controlContent = document.querySelector('.control-content');
            
            const errorMessage = `
                <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 6px; margin: 10px 0; border: 1px solid #f5c6cb;">
                    <strong>æ¸¸æˆåŠ è½½é”™è¯¯:</strong><br>
                    ${e.message}<br>
                    <small>è¯·åˆ·æ–°é¡µé¢é‡è¯•</small><br>
                    <button onclick="window.location.reload()" style="margin-top: 10px; padding: 8px 16px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer;">
                        é‡æ–°åŠ è½½
                    </button>
                </div>
            `;
            
            if (panelContent) panelContent.innerHTML = errorMessage;
            if (controlContent) controlContent.innerHTML = errorMessage;
        });
        
        // æ£€æŸ¥æ¸¸æˆåˆå§‹åŒ–çŠ¶æ€
        function checkGameInitialization() {
            let attempts = 0;
            const maxAttempts = 10;
            
            const checkInterval = setInterval(() => {
                attempts++;
                
                if (window.game && typeof window.game === 'object') {
                    console.log('âœ… Game initialized successfully!');
                    clearInterval(checkInterval);
                    return;
                }
                
                if (attempts >= maxAttempts) {
                    console.error('âŒ Game failed to initialize after', maxAttempts, 'attempts');
                    clearInterval(checkInterval);
                    
                    // å°è¯•æ‰‹åŠ¨åˆå§‹åŒ–
                    try {
                        if (typeof Game !== 'undefined') {
                            console.log('Attempting manual game initialization...');
                            const game = new Game();
                            window.game = game;
                            console.log('âœ… Manual initialization successful!');
                        } else {
                            throw new Error('Game class not defined');
                        }
                    } catch (error) {
                        console.error('Manual initialization failed:', error);
                        
                        const panelContent = document.querySelector('.panel-content');
                        const controlContent = document.querySelector('.control-content');
                        
                        const errorMessage = `
                            <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 6px; margin: 10px 0; border: 1px solid #f5c6cb;">
                                <strong>æ¸¸æˆåˆå§‹åŒ–å¤±è´¥</strong><br>
                                æ— æ³•æ­£å¸¸åŠ è½½æ¸¸æˆï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚<br>
                                <button onclick="window.location.reload()" style="margin-top: 10px; padding: 8px 16px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer;">
                                    é‡æ–°åŠ è½½é¡µé¢
                                </button>
                            </div>
                        `;
                        
                        if (panelContent) panelContent.innerHTML = errorMessage;
                        if (controlContent) controlContent.innerHTML = errorMessage;
                    }
                }
                
                console.log(`Checking game initialization... (${attempts}/${maxAttempts})`);
            }, 1000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkGameInitialization, 2000);
        });
    </script>
    
    <script src="game.js"></script>
</body>
</html>